{% extends "base.html" %}

{% block title %}ホーム - アークナイツ ストーリーアーカイブ{% endblock %}

{% block extra_js %}
<script>
    // Pass card data to JavaScript for filtering and searching
    window.cardData = {{ all_cards | tojson }};
    // Pass base path for search functionality
    window.basePath = '{{ root_path }}';
</script>
<script src="{{ js_path }}search_manager.js"></script>
<script src="{{ js_path }}filters.js"></script>
{% endblock %}

{% block content %}
{% if has_cards %}
<section id="content" class="content-section">
    <h2>ストーリー一覧</h2>
    
    <div class="filter-container">
        <div class="filter-controls">
            <div class="filter-group">
                <label for="type-filter">種類で絞り込み</label>
                <select id="type-filter" class="filter-select">
                    <option value="">すべて</option>
                    <option value="main_story">メインストーリー</option>
                    <option value="SIDESTORY">サイドストーリー</option>
                    <option value="MINISTORY">ミニストーリー</option>
                    <option value="BRANCHLINE">ブランチライン</option>
                    <option value="NONE">その他</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="sort-filter">並び順</label>
                <select id="sort-filter" class="filter-select">
                    <option value="default">デフォルト（メイン→新しい順）</option>
                    <option value="date-desc">開催日（新しい順）</option>
                    <option value="date-asc">開催日（古い順）</option>
                    <option value="name-asc">名前（あいうえお順）</option>
                </select>
            </div>
            <button class="filter-clear">フィルターをクリア</button>
        </div>
        <div class="filter-results">
            <span class="results-count"></span>
        </div>
    </div>
    
    <div class="cards-grid" id="cards-container">
        {% for card in all_cards %}
        <article class="card {% if card.type == 'main_story' %}main-story-card{% else %}event-card{% endif %}">
            <div class="card-header">
                {% if card.type == 'main_story' %}
                <div class="chapter-indicator">
                    第{{ "%02d"|format(card.chapter_number) }}章
                </div>
                {% else %}
                <span class="event-type">{{ card.subtitle }}</span>
                {% endif %}
                <h3 class="card-title">
                    <a href="{{ card.link }}">{{ card.title }}</a>
                </h3>
            </div>
            
            <div class="card-body">
                {% if card.type == 'main_story' %}
                <p class="card-subtitle">{{ card.subtitle }}</p>
                {% else %}
                <p class="event-date">
                    開催期間: {{ card.start_date }} ~ {{ card.end_date }}
                </p>
                <p class="event-stories">
                    ストーリー数: {{ card.story_count }}
                </p>
                {% endif %}
            </div>
            
            <div class="card-footer">
                <a href="{{ card.link }}" 
                   class="btn btn-primary{% if not card.can_access %} btn-disabled{% endif %}">
                    {% if card.can_access %}
                        ストーリーを読む
                    {% else %}
                        準備中
                    {% endif %}
                </a>
            </div>
        </article>
        {% endfor %}
    </div>
</section>
{% endif %}

<section id="about" class="about-section">
    <h2>About</h2>
    <p>
        このサイトは、アークナイツのイベントストーリーを保存・閲覧するための非公式アーカイブです。<br>
        ゲーム内で見逃したストーリーや、もう一度読み返したいストーリーをいつでも楽しむことができます。
    </p>
    <p>
        ストーリーデータは <a href="https://github.com/050644zf/ArknightsStoryJson" target="_blank">ArknightsStoryJson</a> プロジェクトのデータを使用しています。
    </p>
</section>
{% endblock %}